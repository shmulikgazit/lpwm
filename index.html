    <html>
    <head>
    <title>Web Messaging Demo</title>
    </head>
    <body>
    Username: <input id="lp_username" style="border: solid 2px #000">
    <button id="lp_btn_login" style="color:red; ">Login</button>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script>
    function getURLParams(search) {
	var queryParams = {}, queryArray, singleQuery;
	queryArray = search.substr(1).split("&");
	for (var i = 0; i < queryArray.length; i++) {
	    if (queryArray[i].indexOf("=") > -0) {
		singleQuery = queryArray[i].split("=");
		if (singleQuery.length == 2) {
		    queryParams[decodeURIComponent(singleQuery[0])] = decodeURIComponent(singleQuery[1]);
		}
	    }
	}
	return queryParams;
    }

var cookieActions = {
    delimiter: '|',
    set: function (key, values, domain) {
	if (typeof key === 'string' && values.join && typeof (values.join) === "function") {
	    var cookieString = encodeURIComponent(key) + '=' + encodeURIComponent(values.join(this.delimiter)) + ';path=/';
	    if (typeof domain !== 'undefined') {
		cookieString += ';domain=' + domain;
	    }
	    document.cookie = cookieString;
	    return true;
	}
    },
    get: function (key) {
	var token = "\\$" + "&"; // Please do not remove the string concat since grunt replace will fail to replace the string otherwise!!!!!!!!
	if (typeof key === 'string') {
	    var val = (document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(key).replace(/[\-\.\+\*]/g, token) + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1") || null);
	    if (typeof val === 'string') {
		var decoded = decodeURIComponent(val);
		if (decoded) {
		    return decoded.split(this.delimiter);
		}
	    }
	}
    },
    remove: function (key, domain) {
	if (typeof key === 'string') {
	    this.set(key, ['null'], domain);
	    return true;
	}
    }
};
</script>
    <script>
    window.lpTag = window.lpTag || {};
window.lpTag.ovr = {
    domain: 'lptag.liveperson.net',
    tagjs: 'tags.liveperson.net'
};
</script>

    <!-- BEGIN LivePerson Monitor. -->
    <script>
    var queryParamSite = getURLParams(window.location.search).site || "73544404";
</script>
    <script type="text/javascript"> window.lpTag = window.lpTag || {};
if (typeof window.lpTag._tagCount === 'undefined') {
    window.lpTag = {
	site: queryParamSite || '',
	section: lpTag.section || '',
	autoStart: lpTag.autoStart === false ? false : true,
	ovr: lpTag.ovr || {domain: 'lptag.liveperson.net', tagjs: 'tags.liveperson.net'},
	_v: '1.5.1',
	_tagCount: 1,
	protocol: location.protocol,
	events: {
	    bind: function (app, ev, fn) {
		lpTag.defer(function () {
		    lpTag.events.bind(app, ev, fn);
		}, 0);
	    }, trigger: function (app, ev, json) {
		lpTag.defer(function () {
		    lpTag.events.trigger(app, ev, json);
		}, 1);
	    }
	},
	defer: function (fn, fnType) {
	    if (fnType == 0) {
		this._defB = this._defB || [];
		this._defB.push(fn);
	    } else if (fnType == 1) {
		this._defT = this._defT || [];
		this._defT.push(fn);
	    } else {
		this._defL = this._defL || [];
		this._defL.push(fn);
	    }
	},
	load: function (src, chr, id) {
	    var t = this;
	    setTimeout(function () {
		t._load(src, chr, id);
	    }, 0);
	},
	_load: function (src, chr, id) {
	    var url = src;
	    if (!src) {
		url = this.protocol + '//' + ((this.ovr && this.ovr.domain) ? this.ovr.domain : 'lptag.liveperson.net') + '/tag/tag.js?site=' + queryParamSite;
	    }
	    var s = document.createElement('script');
	    s.setAttribute('charset', chr ? chr : 'UTF-8');
	    if (id) {
		s.setAttribute('id', id);
	    }
	    s.setAttribute('src', url);
	    document.getElementsByTagName('head').item(0).appendChild(s);
	},
	init: function () {
	    this._timing = this._timing || {};
	    this._timing.start = (new Date()).getTime();
	    var that = this;
	    if (window.attachEvent) {
		window.attachEvent('onload', function () {
		    that._domReady('domReady');
		});
	    } else {
		window.addEventListener('DOMContentLoaded', function () {
		    that._domReady('contReady');
		}, false);
		window.addEventListener('load', function () {
		    that._domReady('domReady');
		}, false);
	    }
	    if (typeof(window._lptStop) == 'undefined') {
		this.load();
	    }
	},
	start: function () {
	    this.autoStart = true;
	},
	_domReady: function (n) {
	    if (!this.isDom) {
		this.isDom = true;
		this.events.trigger('LPT', 'DOM_READY', {t: n});
	    }
	    this._timing[n] = (new Date()).getTime();
	},
	vars: lpTag.vars || [],
	dbs: lpTag.dbs || [],
	ctn: lpTag.ctn || [],
	sdes: lpTag.sdes || [],
	ev: lpTag.ev || []
    };
    lpTag.init();
} else {
    window.lpTag._tagCount += 1;
} </script>
    <!-- END LivePerson Monitor. -->

    <script>
    var username = getURLParams(window.location.search).username || "";
var url = "https://ec2-52-16-155-233.eu-west-1.compute.amazonaws.com:1980";

if (username) {
    $("#lp_username").attr("disabled", "disabled");
    $("#lp_username").val(username);
    $("#lp_btn_login").hide();

    lpTag.sdes.push({"type": "ctmrinfo", "info": {customerId: username}});

    window.LPJsMethodName = function (callback) {
	$.ajax({
	    url: url + '/login',
	    contentType: "application/json",
	    data: {
		username: username
	    },
	    success: function (data) {
		$.ajax(url + "/generateSsoKey?rt=json&username=" + username, {
		    type: 'get',
		    error: function (XMLHttpRequest, textStatus, errorThrown) {
			if (XMLHttpRequest.responseJSON === undefined || XMLHttpRequest.responseJSON.message === undefined) {
			    callback('UNKNOWN ERROR', 'error occured');
			} else {
			    callback('ERROR', XMLHttpRequest.responseJSON.message);
			}

		    },
		    success: function (ssoData) {
			callback(ssoData.ssoKey);

		    }
		});
	    }
	});
    }
}
else {
    $("#lp_btn_login").click(function () {
	var url = "https://ec2-52-16-155-233.eu-west-1.compute.amazonaws.com:1980";
	var username = $("#lp_username").val();

	$.ajax(url + "/generateSsoKey?rt=json&username=" + username, {
	    type: 'get',
	    error: function (XMLHttpRequest, textStatus, errorThrown) {


	    },
	    success: function (ssoData) {

		window.location.href = updateQueryStringParameter(window.location.href, "username", username);
	    }
	});


	function updateQueryStringParameter(uri, key, value) {
	    var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
	    var separator = uri.indexOf('?') !== -1 ? "&" : "?";
	    if (uri.match(re)) {
		return uri.replace(re, '$1' + key + "=" + value + '$2');
	    }
	    else {
		return uri + separator + key + "=" + value;
	    }
	}
    });
}



</script>
    </body>
    </html>
